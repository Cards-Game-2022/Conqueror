@page "/gameEnvironment"
@inject IJSRuntime JS

    
<div class="container">
    
    <div class="d-flex justify-content-around mt-4">
        <div>
            <h4 class="player-name">@p1.Name</h4>
            <p class="bg-danger p-2 card-points">Vida : @p1.Life</p>
        </div>

        <div>
            <h4 class="player-name">@p2.Name</h4>
            <p class="bg-danger p-2 card-points">Vida : @p2.Life</p>
        </div>
    </div>

    <div class="d-flex justify-content-around mt-5">
        <img src="@p1.UrlPhoto" alt="" width="200" height="300" class = "character-image">
        <img src="@p2.UrlPhoto" alt="" width="200" height="300" class = "character-image">
    </div>

    <div class="d-flex justify-content-center mt-5">
        <div>
            <div class="text-light bg-gradient bg-dark p-2">
                Charms: @p1.Charms
            </div>
        </div>

        <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 text-black ms-2 me-2">
            @foreach (var item in p1.Hand.CardsList)
            {
                <div class="col cursor mt-1" @onclick="@(e => Modal(@item.Id))"  data-bs-toggle="modal" data-bs-target="#exampleModalCenteredScrollable">
                    <div class="card my-card">
                        <img src="@item.UrlPhoto" class="img-fluid m-1" alt="">

                        <div class="card-body p-2">
                            <p class="m-0 p-0 card-text">@item.Name</p> 
                            <span class="m-0 p-0 text-muted">Charms: @item.Charms</span>
                        </div>
                    </div>
                </div>
            }     
        </div>
        
        <div>
            <button class="btn btn-primary" @onclick="InvoqueCard">Fin del Turno</button>
        </div>
    </div>

    
    


    <div class="modal fade text-black" id="exampleModalCenteredScrollable" tabindex="-1"
        aria-labelledby="exampleModalCenteredScrollableTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalCenteredScrollableTitle">@name</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <img src="@photo" alt="" width="450" height="500">

                    <p>@text</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Atras</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Lanzar</button>
                </div>
            </div>
        </div>
    </div>

</div>

@{
    Start();
    NewGame();
}

@code{
    private Game game = new Game();
    private Player p1 = new Player();
    private Player p2 = new Player();
    private string name;
    private string photo;
    private string text;
    private bool gameStart;

    private async void Start() {
        await JS.InvokeVoidAsync("GameEnvironmentBg");
    }
    
    private void InvoqueCard(){
       
       Console.WriteLine(p1.Charms);

    }

    private void NewGame() {
        if (!gameStart) {
            Player[] players = game.NewGame();
            
            p1 = players[0];
            p2 = players[1];
            gameStart = true;

            StateHasChanged(); 
        } 
    }

    private void Modal(int id) {
        Card cd = game.GetCard(id);

        name = cd.Name;
        photo = cd.UrlPhoto;
        text = cd.Text;
    }
}
